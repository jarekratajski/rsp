(function(){'use strict';var g,l="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function m(){var a=document.cookie.match(new RegExp("(?:^|; )"+"deviceId".replace(/([.$?*|{}()\[\]\\\/+^])/g,"\\$1")+"\x3d([^;]*)"));return a?decodeURIComponent(a[1]):void 0}function n(a){this.m=null;this.S=a}n.prototype.show=function(){if(null===this.m){var a=document.createElement("div");a.innerHTML=this.S;a=a.children[0];document.body.appendChild(a);this.m=a}};
function p(a){null!==a.m&&(document.body.removeChild(a.m),a.m=null)};function r(a,b){var c=this;this.i=a;this.root=document.children[0];this.a={};this.o=0;this.O=[];this.C=null;this.Z=window.location.pathname;this.c=b;this.v=[];this.N=function(a,b){function d(a){a.target.f&&(b&&a.preventDefault(),c.v[c.o]=a,c.c(0,c.o+":"+a.target.f+":"+a.type))}c.root.addEventListener(a,d);c.O.push({listener:d,type:a})};this.N("submit",!0);this.C=function(a){null===a.state?b(3,c.Z):b(3,a.state)};this.P=function(a){c.v[c.o]=a.target;b(0,c.o+":1:"+a.type)};window.addEventListener("popstate",
this.C);window.addEventListener("resize",this.P)}g=r.prototype;g.B=function(){var a=this;this.O.forEach(function(b){return a.root.removeEventListener(b.type,b.listener)});window.removeEventListener("popstate",this.C);window.removeEventListener("resize",this.P)};g.da=function(a){delete this.v[a-2];this.o=a};function t(a){function b(a,c){c=c.childNodes;for(var e=0;e<c.length;e++){var f=c[e],q=a+"_"+(e+1);f.f=q;d.a[q]=f;b(q,f)}}var c=document.children[0],d=a;d.root=c;d.a["1"]=c;b("1",c)}
g.V=function(){for(;0<this.root.children.length;)this.root.removeChild(this.root.children[0])};g.aa=function(a,b){this.N(a,b)};g.create=function(a,b,c,d){a=this.a[a];var e=this.a[b];a&&(c=0===c?document.createElement(d):document.createElementNS(c,d),c.f=b,e&&e.parentNode===a?a.replaceChild(c,e):a.appendChild(c),this.a[b]=c)};g.remove=function(a,b){a=this.a[a];b=this.a[b];a&&b&&a.removeChild(b)};
g.Y=function(a,b,c){b=this.a[b][c];switch(typeof b){case "undefined":var d=4;var e=c+" is undefined";break;case "function":d=4;e=c+" is a function";break;case "object":d=3;e=JSON.stringify(b);break;case "string":d=0;e=b;break;case "number":d=1;e=b;break;case "boolean":d=2,e=b}this.c(2,a+":"+d+":"+e)};g.focus=function(a){var b=this;setTimeout(function(){b.a[a].focus()},0)};g.element=function(a){return this.a[a]};g.U=function(a){a!==window.location.pathname&&window.history.pushState(a,"",a)};
g.fa=function(a,b){a=new FormData(this.a[a]);var c=new XMLHttpRequest,d=m();c.open("POST",this.i.r+"bridge/"+d+"/"+this.i.sid+"/form-data/"+b,!0);c.send(a)};g.$=function(a,b){var c=this.a[a],d=m();a=[];b=this.i.r+"bridge/"+d+"/"+this.i.sid+"/file/"+b;for(d=0;d<c.files.length;d++)a.push(c.files[d]);c=new XMLHttpRequest;c.open("POST",b+"/info",!0);c.send(a.map(function(a){return a.name+"/"+a.size}).join("\n"))};
g.ea=function(a,b,c){a=this.a[a];var d=m();b=this.i.r+"bridge/"+d+"/"+this.i.sid+"/file/"+b;d=null;for(var e=0;e<a.files.length;e++)a.files[e].name==c&&(d=a.files[e]);d?(c=new XMLHttpRequest,c.open("POST",b,!0),c.setRequestHeader("x-name",d.name),c.send(d)):console.error("Can't find file with name "+c)};g.ca=function(a){this.a[a].reset()};
g.ba=function(){for(var a=document.getElementsByTagName("link"),b=0;b<a.length;b++){var c=a[b];"stylesheet"===c.getAttribute("rel")&&(c.href=c.href+"?refresh\x3d"+(new Date).getMilliseconds())}};
g.W=function(a,b){var c=this,d=0;try{var e=eval(b)}catch(f){console.error("Error evaluating code "+b,f),e=f,d=1}e instanceof Promise?e.then(function(b){return c.c(4,a+":0:"+JSON.stringify(b))},function(d){console.error("Error evaluating code "+b,d);c.c(4,a+":1:err}")}):(e=1===d?e.toString():JSON.stringify(e),this.c(4,a+":"+d+":"+e))};
g.X=function(a,b){b=this.v[b];var c={},d;for(d in b){var e=b[d];switch(typeof e){case "string":case "number":case "boolean":c[d]=e;break;case "object":"detail"===d&&(c[d]=e)}}this.c(5,a+":"+JSON.stringify(c))};function u(a,b,c,d){this.F=a;this.K=b;this.J=c;this.G=d.host;this.L="https:"===d.protocol;this.h=200;this.b=null;this.T=void 0!==window.WebSocket;this.s=1;this.M=!1;this.A=this.w=null;this.l=window.document.createDocumentFragment()}function v(a){if("function"===typeof Event)return new Event(a);var b=document.createEvent("Event");b.initEvent(a,!1,!1);return b}function w(a,b){switch(b){case 1:x(a);break;case 0:a.T?y(a):x(a)}}
function y(a){var b=(a.L?"wss://":"ws://")+a.G+(a.J+("bridge/web-socket/"+a.F+"/"+a.K));a.b=new WebSocket(b);a.A=function(b){return a.b.send(b)};a.s=0;a.b.addEventListener("open",function(){return z(a)});a.b.addEventListener("close",function(){return A(a)});a.b.addEventListener("error",function(){return B(a)});a.b.addEventListener("message",function(b){return a.u(b.data)});console.log("Trying to open connection to "+b+" using WebSocket")}
function x(a){function b(d){var e=new XMLHttpRequest;e.addEventListener("readystatechange",function(c){c=c.target;if(4===c.readyState)switch(c.status){case 200:d&&z(a),a.u(c.responseText);case 503:b(!1);break;default:B(a),A(a)}});e.open("GET",c+"subscribe",!0);e.send("")}var c=(a.L?"https://":"http://")+a.G+(a.J+("bridge/long-polling/"+a.F+"/"+a.K+"/"));a.s=1;a.A=function(b){var d=new XMLHttpRequest;d.open("POST",c+"publish",!0);d.setRequestHeader("Content-Type","application/json");d.addEventListener("readystatechange",
function(b){b=b.target;if(4===b.readyState)switch(b.status){case 0:case 400:B(a)}});d.send(b)};b(!0);console.log("Trying to open connection to "+c+" using long polling")}function z(a){console.log("Connection opened");var b=v("open");a.M=!0;a.h=200;a.w=a.s;a.l.dispatchEvent(b)}function B(a){console.log("Connection error");var b=v("error");a.l.dispatchEvent(b)}function A(a){console.log("Connection closed");var b=v("close");a.l.dispatchEvent(b)}u.prototype.u=function(a){var b=v("message");b.data=a;this.l.dispatchEvent(b)};
u.prototype.send=function(a){this.A(a)};u.prototype.disconnect=function(){null!=this.b?(this.b.close(),A(this)):console.log("Disconnect allowed only for WebSocket connections")};u.prototype.connect=function(){var a=this;this.M&&console.log("Reconnecting...");if(null!==this.w){var b=this.w;setTimeout(function(){return w(a,b)},this.h)}else switch(this.s){case 0:setTimeout(function(){return w(a,1)},this.h);break;case 1:setTimeout(function(){return w(a,0)},this.h)}this.h=Math.min(2*this.h,5E3)};
l.Object.defineProperties(u.prototype,{j:{configurable:!0,enumerable:!0,get:function(){return this.l}}});var C="true"===window.localStorage.getItem("$bridge.protocolDebugEnabled");function D(a,b){var c=this;this.g=new r(a,this.I.bind(this));t(this.g);this.D=b;this.H=this.u.bind(this);b.j.addEventListener("message",this.H);a=parseInt(a.heartbeatInterval,10);0<a&&(this.R=setInterval(function(){return c.I(6)},a))}D.prototype.I=function(a,b){a=JSON.stringify(void 0!==b?[a,b]:[a]);C&&console.log("\x3c-",a);this.D.send(a)};
D.prototype.u=function(a){C&&console.log("-\x3e",a.data);a=JSON.parse(a.data);var b=a.shift(),c=this.g;switch(b){case 0:c.da.apply(c,a);break;case 1:c.V.apply(c,a);break;case 2:c.aa.apply(c,a);break;case 3:c.Y.apply(c,a);break;case 4:b=a.reverse();for(b=b.pop.bind(b);0<a.length;)switch(b()){case 0:c.create(b(),b(),b(),b());break;case 1:var d=c,e=b(),f=b();var h=b();e=d.a[e];var k=d.a[f];e&&(h=document.createTextNode(h),h.f=f,k&&k.parentNode===e?e.replaceChild(h,k):e.appendChild(h),d.a[f]=h);break;
case 2:c.remove(b(),b());break;case 3:k=b();d=b();f=b();h=b();e=b();k=c.a[k];e?k[f]=h:0===d?k.setAttribute(f,h):k.setAttributeNS(d,f,h);break;case 4:e=b();d=b();f=b();h=b();e=c.a[e];h?e[f]=void 0:0===d?e.removeAttribute(f):e.removeAttributeNS(d,f);break;case 5:d=b();f=b();h=b();c.a[d].style[f]=h;break;case 6:d=b(),f=b(),c.a[d].style[f]=null}break;case 5:c.focus.apply(c,a);break;case 6:c.U.apply(c,a);break;case 7:c.fa.apply(c,a);break;case 8:c.ba.apply(c,a);break;case 9:break;case 10:c.W.apply(c,a);
break;case 11:c.X.apply(c,a);break;case 12:c.$.apply(c,a);break;case 13:c.ea.apply(c,a);break;case 14:c.ca.apply(c,a);break;default:console.error("Procedure "+b+" is undefined")}};D.prototype.B=function(){clearInterval(this.R);this.D.j.removeEventListener("message",this.H);this.g.B()};window.Korolev={setProtocolDebugEnabled:function(a){window.localStorage.setItem("$bridge.protocolDebugEnabled",a.toString());C=a},invokeCallback:function(){return console.log("Korolev is not ready")},swapElementInRegistry:function(){return console.log("Korolev is not ready")}};
window.document.addEventListener("DOMContentLoaded",function(){var a=!0,b=window.kfg,c=new n(b.clw),d=new u(m(),b.sid,b.r,window.location);window.Korolev.disconnect=function(){a=!1;d.disconnect()};window.Korolev.connect=function(){return d.connect()};d.j.addEventListener("open",function(){function a(){f.B();c.show();d.j.removeEventListener("close",a)}p(c);var f=new D(b,d);window.Korolev.swapElementInRegistry=function(a,b){var c=f.g;b.f=a.f;c.a[a.f]=b};window.Korolev.element=function(a){return f.g.element(a)};
window.Korolev.invokeCallback=function(a,b){f.g.c(1,[a,b].join(":"))};d.j.addEventListener("close",a)});d.j.addEventListener("close",function(){a&&d.connect()});d.connect()});}).call(this);
//# sourceMappingURL=korolev-client.min.js.map
